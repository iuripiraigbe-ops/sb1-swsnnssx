# LegalTok - TikTok Jurídico

Um MVP completo de plataforma de vídeos curtos para educação jurídica, inspirado no TikTok. Professores podem criar conteúdo educativo e alunos podem consumir, interagir e aprender de forma dinâmica.

## 🚀 Funcionalidades

### Para Professores
- ✅ Perfis verificáveis com especialidades
- ✅ Upload de vídeos curtos (≤90s)
- ✅ Transcodificação automática (720p + thumbnail)
- ✅ Links de contato e calendário de vendas
- ✅ Estatísticas de engajamento

### Para Alunos
- ✅ Feed infinito de vídeos
- ✅ Navegação por tópicos (Penal, Civil, Constitucional, etc.)
- ✅ Sistema de seguir professores
- ✅ Like, comentário e compartilhamento
- ✅ Feed personalizado (home/following)

### Técnicas
- ✅ Backend completo com Fastify + TypeScript
- ✅ Banco PostgreSQL com Prisma ORM
- ✅ Autenticação JWT (access + refresh)
- ✅ WebSocket para atualizações em tempo real
- ✅ Fila Redis + BullMQ para transcodificação
- ✅ Frontend React + TypeScript + Tailwind
- ✅ Upload de arquivos com validação
- ✅ Rate limiting e CORS

## 🛠️ Stack Tecnológica

### Backend
- **Runtime**: Node.js 20.x
- **Framework**: Fastify
- **Database**: PostgreSQL 16
- **ORM**: Prisma
- **Cache/Fila**: Redis + BullMQ
- **Auth**: JWT + bcrypt
- **Upload**: Multipart + ffmpeg
- **WebSocket**: ws
- **Validação**: Zod

### Frontend
- **Framework**: React 18 + TypeScript
- **Build**: Vite
- **Styling**: Tailwind CSS
- **State**: Zustand
- **Forms**: React Hook Form + Yup
- **Icons**: Lucide React
- **Animations**: Framer Motion

### DevOps
- **Containerização**: Docker + Docker Compose
- **Database**: PostgreSQL + pgAdmin
- **Cache**: Redis
- **CI/CD**: GitHub Actions (configurado)

## 📋 Pré-requisitos

- Node.js 20.x ou superior
- Docker e Docker Compose
- FFmpeg instalado no sistema (para transcodificação)

### Instalando FFmpeg

**Windows:**
```bash
# Via Chocolatey
choco install ffmpeg

# Ou baixe de https://ffmpeg.org/download.html
```

**macOS:**
```bash
brew install ffmpeg
```

**Linux (Ubuntu/Debian):**
```bash
sudo apt update
sudo apt install ffmpeg
```

## 🚀 Instalação e Configuração

### 1. Clone o repositório
```bash
git clone https://github.com/iuripiraigbe-ops/sb1-swsnnssx.git
cd sb1-swsnnssx
```

### 2. Configure as variáveis de ambiente

Crie um arquivo `.env` na raiz do projeto:
```env
VITE_API_URL=http://localhost:3001
VITE_WS_URL=ws://localhost:3001/ws
```

Crie um arquivo `.env` na pasta `server/`:

**Para Desenvolvimento Local:**
```env
# Database
DATABASE_URL="postgresql://legaltok:legaltok123@localhost:5432/legaltok?schema=public"

# Redis
REDIS_URL="redis://localhost:6379"

# JWT
JWT_SECRET="dev-secret-key-change-in-production"
JWT_REFRESH_SECRET="dev-refresh-secret-key-change-in-production"
JWT_EXPIRES_IN="15m"
JWT_REFRESH_EXPIRES_IN="7d"

# Server
PORT=3001
NODE_ENV="development"

# File Upload
UPLOAD_DIR="./uploads"
MAX_FILE_SIZE=100000000

# CORS
CORS_ORIGIN="http://localhost:5173"

# Rate Limiting
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW_MS=900000
```

**Para Produção (Neon + Upstash):**
Veja `MIGRATION_GUIDE.md` para configuração completa.

### 3. Inicie os serviços de infraestrutura
```bash
docker-compose up -d
```

Isso irá iniciar:
- PostgreSQL na porta 5432
- Redis na porta 6379
- pgAdmin na porta 8080 (admin@legaltok.com / admin123)

### 4. Configure o banco de dados
```bash
cd server
npm install
npx prisma generate
npx prisma db push
npm run db:seed
```

### 5. Instale as dependências do frontend
```bash
cd ..
npm install
```

### 6. Inicie os servidores

**Terminal 1 - Backend:**
```bash
cd server
npm run dev
```

**Terminal 2 - Frontend:**
```bash
npm run dev
```

## 🎯 Como Usar

### Acessando a aplicação
- **Frontend**: http://localhost:5173
- **Backend API**: http://localhost:3001
- **pgAdmin**: http://localhost:8080

### Contas de teste
Após rodar o seed, você pode usar estas contas:

**Professores:**
- Email: `ana.silva@legaltok.com` / Senha: `123456`
- Email: `carlos.santos@legaltok.com` / Senha: `123456`
- Email: `maria.costa@legaltok.com` / Senha: `123456`

**Alunos:**
- Email: `joao.aluno@email.com` / Senha: `123456`
- Email: `maria.aluna@email.com` / Senha: `123456`

### Fluxo de uso

1. **Registro/Login**: Acesse a aplicação e faça login
2. **Feed**: Navegue pelos vídeos no feed principal
3. **Upload** (professores): Faça upload de vídeos educativos
4. **Interação**: Like, comente e siga professores
5. **Tópicos**: Explore vídeos por área do direito

## 📁 Estrutura do Projeto

```
sb1-swsnnssx/
├── src/                    # Frontend React
│   ├── components/         # Componentes React
│   ├── hooks/             # Custom hooks
│   ├── lib/               # Utilitários (API client)
│   ├── services/          # Serviços mockados (legacy)
│   ├── store/             # Estado global (Zustand)
│   └── types/             # Tipos TypeScript
├── server/                # Backend Fastify
│   ├── src/
│   │   ├── routes/        # Rotas da API
│   │   ├── services/      # Serviços (Redis, WebSocket, etc.)
│   │   ├── middleware/    # Middlewares (auth, etc.)
│   │   ├── types/         # Tipos e schemas Zod
│   │   └── queues/        # Filas de processamento
│   ├── prisma/            # Schema e migrations
│   └── uploads/           # Arquivos de vídeo
├── docker-compose.yml     # Serviços de infraestrutura
└── README.md             # Este arquivo
```

## 🔧 Scripts Disponíveis

### Frontend
```bash
npm run dev          # Desenvolvimento
npm run build        # Build de produção
npm run preview      # Preview da build
npm run lint         # Linting
```

### Backend
```bash
cd server
npm run dev          # Desenvolvimento
npm run build        # Build
npm run start        # Produção
npm run db:seed      # Popular banco
npm run db:studio    # Prisma Studio
npm run test         # Testes
```

## 🧪 Testes

### Backend
```bash
cd server
npm test             # Testes unitários
npm run test:e2e     # Testes end-to-end
```

### Frontend
```bash
npm test             # Testes (configurar primeiro)
```

## 📊 API Endpoints

### Autenticação
- `POST /auth/register` - Registro
- `POST /auth/login` - Login
- `POST /auth/refresh` - Refresh token
- `GET /me` - Perfil do usuário

### Vídeos
- `GET /videos/feed` - Feed de vídeos
- `POST /videos` - Upload de vídeo
- `GET /videos/:id` - Detalhes do vídeo
- `POST /videos/:id/like` - Like/Unlike
- `GET /videos/:id/comments` - Comentários
- `POST /videos/:id/comments` - Adicionar comentário

### Usuários
- `GET /users/:id` - Perfil do usuário
- `POST /users/follow/:id` - Seguir usuário
- `DELETE /users/follow/:id` - Deixar de seguir

### Tópicos
- `GET /topics` - Lista de tópicos
- `GET /topics/:slug` - Detalhes do tópico
- `GET /topics/:slug/videos` - Vídeos do tópico

## 🔒 Segurança

- Autenticação JWT com refresh tokens
- Senhas hasheadas com bcrypt
- Rate limiting por IP
- Validação de entrada com Zod
- CORS configurado
- Upload de arquivos validado

## 🚀 Deploy

### Produção
1. Configure variáveis de ambiente de produção
2. Use um serviço de transcodificação (Mux, Cloudflare Stream)
3. Configure CDN para vídeos
4. Use Redis Cloud ou similar
5. Configure PostgreSQL em produção

### Docker
```bash
# Build das imagens
docker-compose -f docker-compose.prod.yml build

# Deploy
docker-compose -f docker-compose.prod.yml up -d
```

## 🤝 Contribuindo

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudanças (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## 📝 Licença

Este projeto está sob a licença MIT. Veja o arquivo `LICENSE` para mais detalhes.

## 🆘 Suporte

Se você encontrar algum problema ou tiver dúvidas:

1. Verifique se todos os pré-requisitos estão instalados
2. Confirme se os serviços Docker estão rodando
3. Verifique os logs do servidor
4. Abra uma issue no GitHub

## 🎯 Próximos Passos

- [ ] Integração com Mux/Cloudflare Stream
- [ ] Notificações push
- [ ] Moderação de conteúdo
- [ ] Analytics avançados
- [ ] App mobile (React Native)
- [ ] Pagamentos e assinaturas
- [ ] Live streaming
- [ ] Gamificação

---

**LegalTok** - Transformando a educação jurídica através de vídeos curtos e dinâmicos! 📚⚖️